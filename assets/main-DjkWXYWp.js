var h=t=>{throw TypeError(t)};var g=(t,e,i)=>e.has(t)||h("Cannot "+i);var s=(t,e,i)=>(g(t,e,"read from private field"),i?i.call(t):e.get(t)),l=(t,e,i)=>e.has(t)?h("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),u=(t,e,i,n)=>(g(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),m=(t,e,i)=>(g(t,e,"access private method"),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();var a,d,c,f,b;class y{constructor({navigationDrawer:e,drawerButton:i,content:n}){l(this,f);l(this,a,null);l(this,d,null);l(this,c,null);u(this,a,n),u(this,d,i),u(this,c,e),m(this,f,b).call(this)}async renderPage(){s(this,a).classList.add("fade-out"),await new Promise(n=>setTimeout(n,300));const e=getActiveRoute(),i=routes[e];s(this,a).innerHTML=await i.render(),await i.afterRender(),s(this,a).classList.remove("fade-out"),s(this,a).classList.add("fade-in")}}a=new WeakMap,d=new WeakMap,c=new WeakMap,f=new WeakSet,b=function(){s(this,d).addEventListener("click",()=>{s(this,c).classList.toggle("open")}),document.body.addEventListener("click",e=>{!s(this,c).contains(e.target)&&!s(this,d).contains(e.target)&&s(this,c).classList.remove("open")})};const w=async()=>{if(!("Notification"in window)){console.warn("Browser tidak mendukung notifikasi");return}await Notification.requestPermission()==="granted"?(console.log("Izin notifikasi diberikan"),v()):console.log("Izin notifikasi ditolak")},v=async()=>{try{const t=await navigator.serviceWorker.ready,e={userVisibleOnly:!0,applicationServerKey:k("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk")},i=await t.pushManager.subscribe(e);console.log("Push Subscription berhasil:",i);const n=localStorage.getItem("token");if(!n){alert("Kamu harus login terlebih dahulu!");return}if(!(await fetch("https://story-api.dicoding.dev/v1/",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(i)})).ok)throw new Error("Gagal mengirim subscription ke server");console.log("Subscription berhasil dikirim ke server")}catch(t){console.error("Gagal subscribe push notification:",t)}};function k(t){const e="=".repeat((4-t.length%4)%4),i=(t+e).replace(/-/g,"+").replace(/_/g,"/"),n=atob(i),r=new Uint8Array(n.length);for(let o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r}document.addEventListener("DOMContentLoaded",async()=>{const t=new y({content:document.querySelector("#main-content"),drawerButton:document.querySelector("#drawer-button"),navigationDrawer:document.querySelector("#navigation-drawer")});await t.renderPage(),window.addEventListener("hashchange",async()=>{document.startViewTransition?document.startViewTransition(()=>t.renderPage()):await t.renderPage()});const e=document.getElementById("subscribe-button"),i=document.getElementById("subscribe-feedback");e&&i&&e.addEventListener("click",()=>{e.style.display="none",i.style.display="block"}),"Notification"in window&&navigator.serviceWorker&&w()});
